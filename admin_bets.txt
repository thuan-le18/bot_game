from aiogram import Router, types
from aiogram.filters import Text
from config import ADMIN_ID  # ID cá»§a admin
from database import user_bets  # Dá»¯ liá»‡u cÆ°á»£c cá»§a ngÆ°á»i chÆ¡i

router = Router()

@router.message(Text("ğŸ“Š Xem cÆ°á»£c hiá»‡n táº¡i"), lambda msg: msg.from_user.id == ADMIN_ID)
async def view_current_bets(message: types.Message):
    if not user_bets:
        await message.answer("ğŸ“Œ Hiá»‡n khÃ´ng cÃ³ ai Ä‘ang cÆ°á»£c.")
        return

    bet_info = "ğŸ“Š Danh sÃ¡ch cÆ°á»£c hiá»‡n táº¡i:\n\n"
    for user_id, bet_data in user_bets.items():
        bet_info += f"ğŸ‘¤ User {user_id} - {bet_data['game']} - {bet_data['amount']} VNÄ\n"

    await message.answer(bet_info)

@router.message(Text("âš™ï¸ Chá»‰nh káº¿t quáº£"), lambda msg: msg.from_user.id == ADMIN_ID)
async def edit_game_result(message: types.Message):
    await message.answer("ğŸ›  Nháº­p theo cÃº phÃ¡p: /fix_game [User ID] [Tháº¯ng/Thua]")

@router.message(lambda msg: msg.text.startswith("/fix_game") and msg.from_user.id == ADMIN_ID)
async def set_game_result(message: types.Message):
    parts = message.text.split()
    if len(parts) != 3:
        await message.answer("âš ï¸ Sai cÃº phÃ¡p! Nháº­p: /fix_game [User ID] [Tháº¯ng/Thua]")
        return

    user_id, result = parts[1], parts[2].lower()
    if user_id not in user_bets:
        await message.answer("âš ï¸ User khÃ´ng cÃ³ cÆ°á»£c nÃ o!")
        return

    if result == "tháº¯ng":
        payout = user_bets[user_id]["amount"] * 1.96  # NhÃ¢n tiá»n tháº¯ng
        user_balance[user_id] += payout
        await message.answer(f"âœ… ÄÃ£ cáº­p nháº­t: User {user_id} THáº®NG +{payout} VNÄ")
    else:
        await message.answer(f"âœ… ÄÃ£ cáº­p nháº­t: User {user_id} THUA")

    del user_bets[user_id]  # XÃ³a cÆ°á»£c sau khi xá»­ lÃ½
